<!DOCTYPE html>
<html>
<head>
    <title>PAMS - Advanced Analytics</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { background: rgba(44,62,80,0.9); backdrop-filter: blur(10px); color: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; text-align: center; }
        .analytics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 25px; margin-bottom: 25px; }
        .analytics-card { background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); padding: 25px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .card-title { color: #2c3e50; font-size: 1.4em; font-weight: bold; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .metric-large { font-size: 2.5em; font-weight: bold; color: #3498db; text-align: center; margin: 15px 0; }
        .trend-indicator { padding: 8px 16px; border-radius: 20px; font-weight: bold; margin: 5px; display: inline-block; }
        .trend-up { background: #d4edda; color: #155724; }
        .trend-down { background: #f8d7da; color: #721c24; }
        .recommendation { background: #e3f2fd; padding: 12px; border-radius: 8px; margin: 8px 0; border-left: 4px solid #2196f3; }
        .priority-high { border-left-color: #f44336; background: #ffebee; }
        .priority-medium { border-left-color: #ff9800; background: #fff3e0; }
        .social-post { background: #f8f9fa; padding: 15px; border-radius: 10px; margin: 10px 0; border-left: 4px solid #28a745; }
        .nav-btn { padding: 12px 24px; margin: 0 10px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; text-decoration: none; display: inline-block; transition: all 0.3s ease; }
        .primary-btn { background: linear-gradient(135deg, #3498db, #2980b9); color: white; }
        .secondary-btn { background: linear-gradient(135deg, #95a5a6, #7f8c8d); color: white; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Advanced Analytics Dashboard</h1>
            <p>Deep insights into Aadhi's performance patterns</p>
        </div>

        <div class="analytics-grid">
            <div class="analytics-card">
                <div class="card-title">üò¥ Sleep Analysis</div>
                <div id="sleep-analysis">Loading sleep data...</div>
            </div>

            <div class="analytics-card">
                <div class="card-title">üìà Performance Trends</div>
                <div id="performance-trends">Loading trend analysis...</div>
            </div>

            <div class="analytics-card">
                <div class="card-title">üîÑ Recovery Optimizer</div>
                <div id="recovery-optimizer">Loading recovery data...</div>
            </div>

            <div class="analytics-card">
                <div class="card-title">üë• Team Social</div>
                <div id="team-social">Loading social feed...</div>
                <div style="margin-top: 15px;">
                    <input type="text" id="social-input" placeholder="Share an update..." style="width: 70%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    <button onclick="postUpdate()" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">Post</button>
                </div>
            </div>
        </div>

        <div class="analytics-grid">
            <div class="analytics-card">
                <div class="card-title">üéØ Goal Achievement Patterns</div>
                <div id="goal-patterns">
                    <div style="text-align: center; margin: 20px 0;">
                        <div class="metric-large">87%</div>
                        <p>Average Goal Completion Rate</p>
                    </div>
                    <div class="recommendation">
                        <strong>Pattern Detected:</strong> Higher completion rates on weekdays vs weekends
                    </div>
                    <div class="recommendation">
                        <strong>Suggestion:</strong> Set smaller weekend goals to maintain momentum
                    </div>
                </div>
            </div>

            <div class="analytics-card">
                <div class="card-title">‚ö° Energy Level Prediction</div>
                <div id="energy-prediction">
                    <div style="text-align: center; margin: 20px 0;">
                        <div class="metric-large">High</div>
                        <p>Predicted Energy Tomorrow</p>
                    </div>
                    <div class="recommendation">
                        Based on sleep (8.2h) and recovery metrics, tomorrow is optimal for high-intensity training
                    </div>
                    <div class="recommendation priority-medium">
                        <strong>Recommendation:</strong> Schedule skills practice or scrimmage
                    </div>
                </div>
            </div>

            <div class="analytics-card">
                <div class="card-title">üèÜ Performance Peaks</div>
                <div id="performance-peaks">
                    <div class="recommendation">
                        <strong>Best Performance Days:</strong> Tuesday, Thursday (post-rest days)
                    </div>
                    <div class="recommendation">
                        <strong>Peak Hours:</strong> 4:00 PM - 6:00 PM
                    </div>
                    <div class="recommendation priority-high">
                        <strong>Competition Timing:</strong> Schedule important matches on Tuesdays/Thursdays
                    </div>
                </div>
            </div>

            <div class="analytics-card">
                <div class="card-title">üß† Mental State Insights</div>
                <div id="mental-insights">
                    <div style="text-align: center; margin: 20px 0;">
                        <div class="metric-large">4.2/5</div>
                        <p>Average Mood Score</p>
                    </div>
                    <div class="recommendation">
                        <strong>Mood Boosters:</strong> Training completion (+0.8), Good sleep (+0.6)
                    </div>
                    <div class="recommendation">
                        <strong>Stress Indicators:</strong> Low when homework completed early
                    </div>
                </div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 25px;">
            <a href="/parent" class="nav-btn primary-btn">‚Üê Parent Dashboard</a>
            <a href="/phase2" class="nav-btn primary-btn">Phase 2 Features</a>
            <a href="/" class="nav-btn secondary-btn">üè† Home</a>
        </div>
    </div>

    <script>
        async function loadAdvancedAnalytics() {
            // Load sleep analysis
            try {
                const sleepResponse = await fetch('/api/sleep-analysis');
                const sleepData = await sleepResponse.json();
                
                document.getElementById('sleep-analysis').innerHTML = `
                    <div style="text-align: center; margin: 15px 0;">
                        <div class="metric-large">${sleepData.average_sleep}h</div>
                        <p>Average Sleep Duration</p>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 15px 0;">
                        <div>Consistency: <strong>${sleepData.consistency_score}%</strong></div>
                        <div>Optimal Days: <strong>${sleepData.optimal_sleep_days}</strong></div>
                    </div>
                    ${sleepData.recommendations.map(rec => `<div class="recommendation">${rec}</div>`).join('')}
                `;
            } catch (error) {
                document.getElementById('sleep-analysis').innerHTML = '<p>Error loading sleep data</p>';
            }

            // Load performance trends
            try {
                const trendsResponse = await fetch('/api/performance-trends');
                const trendsData = await trendsResponse.json();
                
                if (trendsData.status !== 'insufficient_data') {
                    const trendHtml = Object.entries(trendsData.trends).map(([key, trend]) => {
                        const trendClass = trend === 'improving' ? 'trend-up' : 'trend-down';
                        const trendIcon = trend === 'improving' ? 'üìà' : 'üìâ';
                        return `<div class="trend-indicator ${trendClass}">${trendIcon} ${key.replace('_', ' ')}: ${trend}</div>`;
                    }).join('');
                    
                    document.getElementById('performance-trends').innerHTML = `
                        <div style="text-align: center; margin: 15px 0;">
                            <div class="metric-large">${trendsData.overall_direction === 'positive' ? 'üìà' : '‚ö†Ô∏è'}</div>
                            <p>${trendsData.overall_direction === 'positive' ? 'Positive Trajectory' : 'Needs Attention'}</p>
                        </div>
                        ${trendHtml}
                    `;
                } else {
                    document.getElementById('performance-trends').innerHTML = '<p>Need more data for trend analysis</p>';
                }
            } catch (error) {
                document.getElementById('performance-trends').innerHTML = '<p>Error loading trends</p>';
            }

            // Load recovery optimizer
            try {
                const recoveryResponse = await fetch('/api/recovery-optimizer');
                const recoveryData = await recoveryResponse.json();
                
                document.getElementById('recovery-optimizer').innerHTML = `
                    <div style="text-align: center; margin: 15px 0;">
                        <div class="metric-large">${recoveryData.recovery_score}%</div>
                        <p>Recovery Score</p>
                    </div>
                    <div style="margin: 15px 0;">
                        Sleep: ${recoveryData.sleep_quality}h | Mental: ${recoveryData.mental_state}/5 | Load: ${recoveryData.training_load} days
                    </div>
                    ${recoveryData.recommendations.map(rec => 
                        `<div class="recommendation priority-${rec.priority}"><strong>${rec.type.toUpperCase()}:</strong> ${rec.action}</div>`
                    ).join('')}
                `;
            } catch (error) {
                document.getElementById('recovery-optimizer').innerHTML = '<p>Error loading recovery data</p>';
            }

            // Load team social
            try {
                const socialResponse = await fetch('/api/team-social');
                const socialData = await socialResponse.json();
                
                const postsHtml = socialData.posts.map(post => `
                    <div class="social-post">
                        <strong>${post.author}</strong> - ${new Date(post.timestamp).toLocaleDateString()}<br>
                        ${post.content}
                        <div style="margin-top: 8px; color: #666;">üëç ${post.likes || 0} likes</div>
                    </div>
                `).join('');
                
                document.getElementById('team-social').innerHTML = postsHtml || '<p>No recent posts</p>';
            } catch (error) {
                document.getElementById('team-social').innerHTML = '<p>Error loading social feed</p>';
            }
        }

        async function postUpdate() {
            const input = document.getElementById('social-input');
            const content = input.value.trim();
            
            if (content) {
                try {
                    await fetch('/api/team-social', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ content })
                    });
                    
                    input.value = '';
                    loadAdvancedAnalytics(); // Refresh social feed
                } catch (error) {
                    alert('Error posting update');
                }
            }
        }

        loadAdvancedAnalytics();
        setInterval(loadAdvancedAnalytics, 60000); // Refresh every minute
    </script>
</body>
</html>